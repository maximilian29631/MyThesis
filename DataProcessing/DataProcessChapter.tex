\documentclass[main.tex]{subfiles}

\begin{document}
The detectors were tested using an oscilloscope to check for their signals.
The timing of each detector signal was recorded and used to tune the data acquisition. 
The signals were then inserted into a digital data acquisition system.

\section{Data Acquisition}

All the signals for all the detectors were sent to digitizers.
These digitizers were three 250 mega-samples per second 16 channel XIA PIXIE modules. 
They were run with the digital NSCL system.
The first module had the implant detectors and the four gamma detectors. 
The second module had five signals from the PPAC and one signal for the Si detector. 
Both of these had the beam on signal, beam off signal, a 100 Hz pulser, and the signal from the PIN photo-diode. 
The third module only recorded the digitized wave-forms from the PVT detector.

Each of the channels on each of those modules outputted a time stamp and an energy calculated from a trapezoidal filter.
The third module output the digitized waveform over 400 ns.
The digitizers took samples every 8 ns.
The clock used was a stable EPSON SGR-8002JC programmable crystal oscillator.

The first thing the PIXIE modules did was to digitize the wave forms of the signals.
The digital wave forms of the signals were only saved for the PVT implant detector.
The PIXIE modules' software applied a trapezoidal energy filter to the digital wave-forms.

\subsection{Trapezoidal Filter Description}
The parameters of the trapezoidal filter needed to be set by hand.
First, three sums of the digitize wave-forms were taken.
The first sum was over a time known as $tPEAKING$.
Then, a second sum was taken directly after the first over a time known as $tGAP$.
Then, a third sum was taken directly after the the second with over a period of $tPEAKING$ again.
These three sums were added with equation \ref{eq:ensum}

\begin{equation}
	E = C_{0} * S_{0} + C_{g} * S_{g} + C_{1} * S_{1} 
	\label{eq:ensum}
\end{equation} 

with $S_{0}$ being the first sum over $tPEAKING$ described above, $S_{G}$ being the sum over $tGAP$, and $S_{1}$ being the second sum over $tPEAKING$.
$C_{0}$ is described in equation \ref{eq:c0sum}

\begin{equation}
	C_{0} = \frac{-(1 - e^{\frac{tSPL}{\tau}})e^{\frac{tPEAKING}{\tau}}}{1 - e^{\frac{tPEAKING}{\tau}}}
	\label{eq:c0sum}
\end{equation}

where $tPEAKING$ is the time described above, $tSPL$ is the 8 ns sampling time, and $\tau$ an additional parameter.

$C_{g}$ is described in \ref{eq:cgsum}

\begin{equation}
	C_{g} = 1 - e^{\frac{tSPL}{\tau}}
	\label{eq:cgsum}
\end{equation}

with the same variables.
Finally, $C_{1}$ is described in \ref{eq:c1sum}.

\begin{equation}
	C_{1} = \frac{1 - e^{\frac{tSPL}{\tau}}}{1 - e^{\frac{tPEAKING}{\tau}}}
	\label{eq:c1sum}
\end{equation}

With the same variables.
This filter averaged the background before a pulse in $C_{0}$ over $tPEAKING$.
It took a sample of the pulse, averaged over $tPEAKING$ again in $C_{1}$.
Then, it subtracted off $C_{0}$ from $C_{1}$, after adjusting for the exponential decay of the pulse.
The time constant of that decay is the $\tau$ parameter.
When tuning the PIXIE system, the $\tau$ parameter has the most effect on the output energy.

For this experiment, the various filter parameters are summarized in table \ref{tab:pixieparams}  
%
\begin{table}[!hbt]
	\centering
	\caption{Energy Filter Parameters}
	\resizebox{\textwidth}{!}{
			\begin{tabular}{lrrr}
			Detector & $\tau$ & $tPEAKING$ & $tGAP$ \\ \hline
			PVT implant & 60 ns & 208 ns & 128 ns \\
			All CsI (Na) Detectors & 900 ns & 480 ns & 48 ns \\
			PPAC Channels & 300000 ns & 1200 ns & 96 ns  
			\end{tabular}}	
			\label{tab:pixieparams}
\end{table}
%

There was also a trigger filter in the PIXIE system.
The filter was the same, but the times were much shorter, so that the trigger filter could work quicker. 
There was a threshold that the output of the trigger filter had to be above in order to be recorded.
These values are shown in table \ref{tab:trigfilter}

%
\begin{table}[!hbt]
	\centering
	\caption{Trigger Filter Parameters}
	\resizebox{\textwidth}{!}{
			\begin{tabular}{lrrr}
			Detector & $tPEAKING$ & $tGAP$ & Threshold\\ \hline
			PVT implant & 104 ns & 104 ns & 30 \\ 
			All CsI (Na) Detectors & 200 ns & 72 ns & 20 \\
			PPAC Channels & 904 & 104 & 200 
			\end{tabular}}	
			\label{tab:trigfilter}
\end{table}
%

The peak of the trigger filter was used to calculate the time stamps of the events.  

\subsection{Data Acquisition Software}
In order to set the parameters of the various filters, a program called NSCOPE was used \cite{DAQ17}.
The program GUI was used to set the rise time, the gap, and the threshold for both the energy filter and the trigger filter.
These parameters were set differently for each detector type.
The CsI(Na) detectors (the implant and the 4 gamma detectors) shared the rise time and gap time, while other detectors had different parameters.
Sample spectra were taken with NSCOPE, and the parameters saved to a file.

This file was loaded with a program called ReadOut, which ran the data taking.
The ReadOut program used a ringbuffer in order to record the output of the data.
The program recorded data as an .evt binary file if the record option was selected.

The ringbuffer was also fed to a program called scalers.
This gave the rates of the events coming into each channel.
It gave an input rate to each channel, the recorded rate, and the total over each run.
This was to check how each channel in each module was doing.

For online analysis, a program called SpecTcl was used.
It took the evt files and processed them into histograms.
These histograms could be put in coincidence.
Displays of the implant detector energy and rate were displayed.
The energy of the implant vs time was also displayed.
Additionally, the implant energy vs time since last beam on was plotted as a 2-D spectra.
The decay curves were also plotted.
These were created by histogram the time in the detector minus the time since the last beam on.
These histograms were used as diagnostics. 
The program allowed for gates to be drawn.


\section{Data Taking and Processing}
To take data, the ReadOutGUI program was activated. 
Data was taken in one hour intervals called runs, unless one of the detectors stopped counting early
If a detector stopped early, it was the up detector.
When that happened, the run was ended before one hour was up. 
The events built by Readout had a time interval of 8000 ns.

Each run generated one or more .evt files. 
The resulting .evt files of ReadOut were processed using a program called DDAS dumper.
This converted the .evt files to ROOT files.
One .evt was dumped to .root file. 
These ROOT files contained a TTree that had the energy and time stamps of each detector.
The information was saved event by event. 
It was formatted in a C++ class called DDASEvent. 
This event class contained data for each channel from the data acquisition.
The energy was given out in ADC units and was not calibrated.
These units had a range from 0 to 32767.
The time was given counts of DAQ clock.
The digitized wave forms were also saved in this event. 

From the ROOT files from the ddasdumper, another ROOT file was built.
All the ROOT files from one run was built into one new ROOT file. 
These files were processed with a modified version of a program called $scan$.
The original version was written by Stan Paulauskas.
The TTree was looped over event by event.
For each event, each channel was looped over. 
For the first event and first channel, the time integer was recorded. 
This first time was subtracted from all subsequent time stamps.
The time differences were multiplied 8 ns to turn them into time in seconds. 
Then, the various energies and times for each detector were built into histograms for each channel. 
During looping through the events, the energy and times for the implant detectors, four gamma detectors, beam on signal, and beam off signals were saved to a variable.
This information was used to build new events for a new TTree.

Each event started with a non-zero energy reading in any of the five detectors.
Then, a 400 ns long time gate opened, during which all energies and times were saved into the event.
The time signatures of the last beam on and beam off signals were also saved into each event.
The energies of the beam on or beam off signals were 0 or 1.
\end{document}
